#!/bin/sh

SLEEP_SECONDS="${SLEEP_SECONDS:-6000}"
PREFIX="${PREFIX:-}"

# Create kubeconfig file
kubectl config set-cluster "cluster" \
    --server=kubernetes.default \
    --certificate-authority=/run/secrets/kubernetes.io/serviceaccount/ca.crt \
    --embed-certs=true

# Someday kubectl will support file arguments for sensitive strings
kubectl config set-credentials "sa" \
    --token="$(< /run/secrets/kubernetes.io/serviceaccount/token)"

while [ true ]; do
    sleep "$SLEEP_SECONDS"
done
